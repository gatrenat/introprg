<!DOCTYPE html>
<html class="writer-html5" lang="ca" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Extracció de mètodes &mdash; Introducció a la programació amb Java 2023-24 documentació</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=eafc0fe6" />
      <link rel="stylesheet" type="text/css" href="_static/moistyle.css?v=0e2f4d36" />

  
    <link rel="shortcut icon" href="_static/logoprg.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=4385e19b"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/translations.js?v=d8dd923b"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="Quant a aquests documents" href="about.html" />
    <link rel="index" title="Índex" href="genindex.html" />
    <link rel="search" title="Cerca" href="search.html" />
    <link rel="next" title="Moviment de mètodes" href="refactoring_method_movement.html" />
    <link rel="prev" title="Objectiu de refacció" href="refactoring_exemple_objectiu.html" />
     
    <script class="googleanalytics" src="_static/moiscripts.js"></script>
    <meta name="robots" content="noindex">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Introducció a la programació amb Java
              <img src="_static/logoprg.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                Curs 2023-24
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="primeres_passes.html">Primeres passes</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">Elements bàsics de la programació</a></li>
<li class="toctree-l1"><a class="reference internal" href="moduls.html">Mòduls</a></li>
<li class="toctree-l1"><a class="reference internal" href="fitxers.html">Fitxers</a></li>
<li class="toctree-l1"><a class="reference internal" href="poo.html">Programació Orientada a Objectes</a></li>
<li class="toctree-l1"><a class="reference internal" href="bib.html">Biblioteques</a></li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Validació d'aplicacions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="refactoring.html">Refactoring</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="refactoring_intro.html">Què és el <em>refactoring</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_exemple.html">El lloguer de vehicles</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Extracció de mètodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_method_movement.html">Moviment de mètodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_tmp_call.html">Temporals per crides</a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_responsabilitat.html">Moviment de responsabilitat</a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_removetmps.html">Eliminació de variables temporals</a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_metodes_lleugers.html">Una funcionalitat per mètode</a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_altres.html">Altres passes de refacció</a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_conclusions.html">Conclusions</a></li>
<li class="toctree-l2"><a class="reference internal" href="refactoring_exercicis.html">Exercicis de <em>Refactoring</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apendix.html">Apèndix</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Introducció a la programació amb Java</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="refactoring.html">Refactoring</a></li>
      <li class="breadcrumb-item active">Extracció de mètodes</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="refactoring_exemple_objectiu.html" class="btn btn-neutral float-left" title="Objectiu de refacció" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="refactoring_method_movement.html" class="btn btn-neutral float-right" title="Moviment de mètodes" accesskey="n">Següent <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
    
           <div itemprop="articleBody">
             
  <section id="extraccio-de-metodes">
<h1>Extracció de mètodes<a class="headerlink" href="#extraccio-de-metodes" title="Enllaça amb aquesta capçalera"></a></h1>
<p>A aquesta secció realitzarem els primers passos de refacció sobre el nostre
codi d'exemple. En concret, es realitza un pas de refacció conegut com a
<em>extracció de mètode</em>.</p>
<p>Per un mètode tan llarg com <code class="docutils literal notranslate"><span class="pre">Client.informe()</span></code>, potser una de les passes de
refacció més adequada és aconseguir descomposar-lo en mètodes més petits.</p>
<p>A aquest tipus de refacció li direm <em>extracció de mètode</em>.</p>
<p>Una de les pistes que ens ofereix el codi que es beneficiaria d'una extracció
de mètode és que és tan llarg que, per poder-lo entendre, acabem posant
comentaris separant diferents seccions.</p>
<p>Per exemple, considera el següent codi:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cm">/* mostra un missatge amb el mes anterior i el mes següent de</span>
<span class="linenos"> 2</span><span class="cm"> * mesActual per l&#39;any anyActual.</span>
<span class="linenos"> 3</span><span class="cm"> * Pressuposa que mesActual és un valor entre 1 i 12.  */</span>
<span class="linenos"> 4</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">mostraMesAnteriorISeguent</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">mesActual</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">anyActual</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="c1">// calcula i mostra el mes anterior</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mesAnterior</span><span class="p">,</span><span class="w"> </span><span class="n">anyAnterior</span><span class="p">;</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mesActual</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="n">mesAnterior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span>
<span class="linenos"> 9</span><span class="w">        </span><span class="n">anyAnterior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anyActual</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">10</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">11</span><span class="w">        </span><span class="n">mesAnterior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mesActual</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">12</span><span class="w">        </span><span class="n">anyAnterior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anyActual</span><span class="p">;</span>
<span class="linenos">13</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">14</span><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Mes anterior: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mesAnterior</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">anyAnterior</span><span class="p">);</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="w">    </span><span class="c1">// calcula i mostra el mes següent</span>
<span class="linenos">17</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mesSeguent</span><span class="p">,</span><span class="w"> </span><span class="n">anySeguent</span><span class="p">;</span>
<span class="linenos">18</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mesActual</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">19</span><span class="w">        </span><span class="n">mesSeguent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">20</span><span class="w">        </span><span class="n">anySeguent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anyActual</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">21</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">22</span><span class="w">        </span><span class="n">mesSeguent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mesActual</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">23</span><span class="w">        </span><span class="n">anySeguent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anyActual</span><span class="p">;</span>
<span class="linenos">24</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">25</span><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Mes següent: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mesSeguent</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">anySeguent</span><span class="p">);</span>
<span class="linenos">26</span><span class="p">}</span>
</pre></div>
</div>
<p>Aquest codi realitza dues coses diferents:</p>
<ol class="arabic simple">
<li><p>calcula i mostra el mes anterior</p></li>
<li><p>calcula i mostra el mes següent</p></li>
</ol>
<p>Quan un mètode fa més d'una cosa, sol resultar molt convenient
<em>delegar</em> algunes o totes aquestes coses a nous mètodes. Això facilita
la llegibilitat i el reaprofitament.</p>
<p>En aquest exemple, aplicant l'extracció de mètodes aconseguirem el
següent codi:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cm">/* mostra un missatge amb el mes anterior i el mes següent de</span>
<span class="linenos"> 2</span><span class="cm"> * mesActual per l&#39;any anyActual.</span>
<span class="linenos"> 3</span><span class="cm"> * Pressuposa que mesActual és un valor entre 1 i 12.*/</span>
<span class="linenos"> 4</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">mostraMesAnteriorISeguent</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">mesActual</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">anyActual</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="n">mostraMesAnterior</span><span class="p">(</span><span class="n">mesActual</span><span class="p">,</span><span class="w"> </span><span class="n">anyActual</span><span class="p">);</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="n">mostraMesSeguent</span><span class="p">(</span><span class="n">mesActual</span><span class="p">,</span><span class="w"> </span><span class="n">anyActual</span><span class="p">);</span>
<span class="linenos"> 7</span><span class="p">}</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">mostraMesAnterior</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">mesActual</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">anyActual</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">10</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mesAnterior</span><span class="p">,</span><span class="w"> </span><span class="n">anyAnterior</span><span class="p">;</span>
<span class="linenos">11</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mesActual</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">12</span><span class="w">        </span><span class="n">mesAnterior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span>
<span class="linenos">13</span><span class="w">        </span><span class="n">anyAnterior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anyActual</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">14</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">15</span><span class="w">        </span><span class="n">mesAnterior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mesActual</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">16</span><span class="w">        </span><span class="n">anyAnterior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anyActual</span><span class="p">;</span>
<span class="linenos">17</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">18</span><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Mes anterior: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mesAnterior</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">anyAnterior</span><span class="p">);</span>
<span class="linenos">19</span><span class="p">}</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">mostraMesSeguent</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">mesActual</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">anyActual</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">22</span><span class="w">    </span><span class="c1">// XXX TODO</span>
<span class="linenos">23</span><span class="p">}</span>
</pre></div>
</div>
<p>El mètode <code class="docutils literal notranslate"><span class="pre">mostraMesSeguent()</span></code> te'l deixo per que t'exercitis.</p>
<p>No sempre resultarà tan fàcil fer l'extracció del mètode com en aquest
exemple. De vegades hi haurà variables compartides o parts de codi
barrejades.</p>
<p>Per exemple, considera com canviaria la situació per extreure el mètode si
<code class="docutils literal notranslate"><span class="pre">mostraMesAnteriorISeguent()</span></code> haguera estat codificat de la següent manera:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cm">/* mostra un missatge amb el mes anterior i el mes següent de</span>
<span class="linenos"> 2</span><span class="cm"> * mesActual per l&#39;any anyActual.</span>
<span class="linenos"> 3</span><span class="cm"> * Pressuposa que mesActual és un valor entre 1 i 12.  */</span>
<span class="linenos"> 4</span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">mostraMesAnteriorISeguent</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">mesActual</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">anyActual</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">mesAnterior</span><span class="p">,</span><span class="w"> </span><span class="n">mesSeguent</span><span class="p">;</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">anyAnterior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anyActual</span><span class="p">,</span><span class="w"> </span><span class="n">anySeguent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anyActual</span><span class="p">;</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mesActual</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="n">mesAnterior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span>
<span class="linenos"> 9</span><span class="w">        </span><span class="n">anyAnterior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anyActual</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">10</span><span class="w">        </span><span class="n">mesSeguent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="linenos">11</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mesActual</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">12</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">12</span><span class="w">        </span><span class="n">mesAnterior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">;</span>
<span class="linenos">13</span><span class="w">        </span><span class="n">mesSeguent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">14</span><span class="w">        </span><span class="n">anySeguent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">anyActual</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">15</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">16</span><span class="w">        </span><span class="n">mesAnterior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mesActual</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">17</span><span class="w">        </span><span class="n">mesSeguent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mesActual</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="linenos">18</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">19</span><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Mes anterior: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mesAnterior</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">anyAnterior</span><span class="p">);</span>
<span class="linenos">20</span><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Mes següent: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mesSeguent</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">anySeguent</span><span class="p">);</span>
<span class="linenos">21</span><span class="p">}</span>
</pre></div>
</div>
<p>En un codi com aquest, extreure les dues funcionalitats barrejades, haguera
estat una mica menys directe.</p>
<section id="el-metode-informe">
<h2>El mètode <code class="docutils literal notranslate"><span class="pre">informe()</span></code><a class="headerlink" href="#el-metode-informe" title="Enllaça amb aquesta capçalera"></a></h2>
<p>Tornant al nostre mètode <code class="docutils literal notranslate"><span class="pre">Client.informe()</span></code>, una part que podríem
considerar candidata a extreure per començar és el bloc del
<code class="docutils literal notranslate"><span class="pre">switch</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">informe</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bonificacions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">resultat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Informe de lloguers del client &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos"> 5</span><span class="w">        </span><span class="n">getNom</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="linenos"> 6</span><span class="w">        </span><span class="s">&quot; (&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">getNif</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;)\n&quot;</span><span class="p">;</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Lloguer</span><span class="w"> </span><span class="n">lloguer</span><span class="p">:</span><span class="w"> </span><span class="n">lloguers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">quantitat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="hll"><span class="linenos"> 9</span><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">lloguer</span><span class="p">.</span><span class="na">getVehicle</span><span class="p">().</span><span class="na">getCategoria</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="linenos">10</span><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">Vehicle</span><span class="p">.</span><span class="na">BASIC</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">11</span><span class="w">                </span><span class="n">quantitat</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">12</span><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lloguer</span><span class="p">.</span><span class="na">getDies</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="linenos">13</span><span class="w">                    </span><span class="n">quantitat</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">lloguer</span><span class="p">.</span><span class="na">getDies</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.5</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">14</span><span class="w">                </span><span class="p">}</span>
</span><span class="hll"><span class="linenos">15</span><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">16</span><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">Vehicle</span><span class="p">.</span><span class="na">GENERAL</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">17</span><span class="w">                </span><span class="n">quantitat</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">18</span><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lloguer</span><span class="p">.</span><span class="na">getDies</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="linenos">19</span><span class="w">                    </span><span class="n">quantitat</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">lloguer</span><span class="p">.</span><span class="na">getDies</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.5</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">20</span><span class="w">                </span><span class="p">}</span>
</span><span class="hll"><span class="linenos">21</span><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">22</span><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="n">Vehicle</span><span class="p">.</span><span class="na">LUXE</span><span class="p">:</span>
</span><span class="hll"><span class="linenos">23</span><span class="w">                </span><span class="n">quantitat</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lloguer</span><span class="p">.</span><span class="na">getDies</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">24</span><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span class="hll"><span class="linenos">25</span><span class="w">        </span><span class="p">}</span>
</span><span class="linenos">26</span>
<span class="linenos">27</span><span class="w">        </span><span class="c1">// afegeix lloguers freqüents</span>
<span class="linenos">28</span><span class="w">        </span><span class="n">bonificacions</span><span class="w"> </span><span class="o">++</span><span class="p">;</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="w">        </span><span class="c1">// afegeix bonificació per dos dies de lloguer de Luxe</span>
<span class="linenos">31</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lloguer</span><span class="p">.</span><span class="na">getVehicle</span><span class="p">().</span><span class="na">getCategoria</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Vehicle</span><span class="p">.</span><span class="na">LUXE</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="linenos">32</span><span class="w">                </span><span class="n">lloguer</span><span class="p">.</span><span class="na">getDies</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">33</span><span class="w">            </span><span class="n">bonificacions</span><span class="w"> </span><span class="o">++</span><span class="p">;</span>
<span class="linenos">34</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">35</span>
<span class="linenos">36</span><span class="w">        </span><span class="c1">// composa els resultats d&#39;aquest lloguer</span>
<span class="linenos">37</span><span class="w">        </span><span class="n">resultat</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;\t&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">38</span><span class="w">            </span><span class="n">lloguer</span><span class="p">.</span><span class="na">getVehicle</span><span class="p">().</span><span class="na">getMarca</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">39</span><span class="w">            </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">40</span><span class="w">            </span><span class="n">lloguer</span><span class="p">.</span><span class="na">getVehicle</span><span class="p">().</span><span class="na">getModel</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;: &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">41</span><span class="w">            </span><span class="p">(</span><span class="n">quantitat</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;€&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="linenos">42</span><span class="w">        </span><span class="n">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">quantitat</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>
<span class="linenos">43</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">44</span>
<span class="linenos">45</span><span class="w">    </span><span class="c1">// afegeix informació final</span>
<span class="linenos">46</span><span class="w">    </span><span class="n">resultat</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;Import a pagar: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;€\n&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">47</span><span class="w">        </span><span class="s">&quot;Punts guanyats: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bonificacions</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="linenos">48</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">resultat</span><span class="p">;</span>
<span class="linenos">49</span><span class="p">}</span>
</pre></div>
</div>
<p>Com que en aquest cas, el procés és una mica més complex que amb
l'exemple del <code class="docutils literal notranslate"><span class="pre">mesAnteriorSeguent()</span></code>, haurem d'anar amb més compte.</p>
<p>Per començar, hem de detectar quines són les dependències del fragment
de codi a extreure respecte de la resta del mètode. Podem veure que el
bloc del <code class="docutils literal notranslate"><span class="pre">switch</span></code> requereix les variables <code class="docutils literal notranslate"><span class="pre">lloguer</span></code> i
<code class="docutils literal notranslate"><span class="pre">quantitat</span></code>. D'aquestes variables, <code class="docutils literal notranslate"><span class="pre">lloguer</span></code> només és consultada
dins del codi, mentre que <code class="docutils literal notranslate"><span class="pre">quantitat</span></code> és modificada. <code class="docutils literal notranslate"><span class="pre">lloguer</span></code> el
podem passar com a paràmetre amb tranquil·litat. Amb <code class="docutils literal notranslate"><span class="pre">quantitat</span></code>
però, haurem d'anar amb compte. Com que en aquest cas és només una,
podem considerar retornar el seu valor. Donat que <code class="docutils literal notranslate"><span class="pre">quantitat</span></code>
s'inicialitza a 0 a cada volta del bucle i se li assigna el valor dins
del <code class="docutils literal notranslate"><span class="pre">switch</span></code>, podem simplement assignar-li el valor de retorn del
nou mètode que estem definint.</p>
<p>El codi resultant per <code class="docutils literal notranslate"><span class="pre">Client.informe()</span></code> podria ser el següent:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">informe</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">bonificacions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">resultat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Informe de lloguers del client &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos"> 5</span><span class="w">        </span><span class="n">getNom</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="linenos"> 6</span><span class="w">        </span><span class="s">&quot; (&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">getNif</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;)\n&quot;</span><span class="p">;</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Lloguer</span><span class="w"> </span><span class="n">lloguer</span><span class="p">:</span><span class="w"> </span><span class="n">lloguers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="linenos"> 8</span><span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">quantitat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quantitatPerLloguer</span><span class="p">(</span><span class="n">lloguer</span><span class="p">);</span>
</span><span class="linenos"> 9</span>
<span class="linenos">10</span><span class="w">        </span><span class="c1">// afegeix lloguers freqüents</span>
<span class="linenos">11</span><span class="w">        </span><span class="n">bonificacions</span><span class="w"> </span><span class="o">++</span><span class="p">;</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="w">        </span><span class="c1">// afegeix bonificació per dos dies de lloguer de Luxe</span>
<span class="linenos">14</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lloguer</span><span class="p">.</span><span class="na">getVehicle</span><span class="p">().</span><span class="na">getCategoria</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Vehicle</span><span class="p">.</span><span class="na">LUXE</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="linenos">15</span><span class="w">                </span><span class="n">lloguer</span><span class="p">.</span><span class="na">getDies</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">16</span><span class="w">            </span><span class="n">bonificacions</span><span class="w"> </span><span class="o">++</span><span class="p">;</span>
<span class="linenos">17</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="w">        </span><span class="c1">// composa els resultats d&#39;aquest lloguer</span>
<span class="linenos">20</span><span class="w">        </span><span class="n">resultat</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;\t&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">21</span><span class="w">            </span><span class="n">lloguer</span><span class="p">.</span><span class="na">getVehicle</span><span class="p">().</span><span class="na">getMarca</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">22</span><span class="w">            </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">23</span><span class="w">            </span><span class="n">lloguer</span><span class="p">.</span><span class="na">getVehicle</span><span class="p">().</span><span class="na">getModel</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;: &quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">24</span><span class="w">            </span><span class="p">(</span><span class="n">quantitat</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;€&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="linenos">25</span><span class="w">        </span><span class="n">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">quantitat</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>
<span class="linenos">26</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="w">    </span><span class="c1">// afegeix informació final</span>
<span class="linenos">29</span><span class="w">    </span><span class="n">resultat</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;Import a pagar: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;€\n&quot;</span><span class="w"> </span><span class="o">+</span>
<span class="linenos">30</span><span class="w">        </span><span class="s">&quot;Punts guanyats: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bonificacions</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="p">;</span>
<span class="linenos">31</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">resultat</span><span class="p">;</span>
<span class="linenos">32</span><span class="p">}</span>
</pre></div>
</div>
<p>En aquest exemple, el mètode <code class="docutils literal notranslate"><span class="pre">quantitatPerLloguer()</span></code> apareix a un únic
lloc. És freqüent, però, que quan extraiem un mètode, el seu codi estigués
duplicat en múltiples llocs del codi. Quan reemplacem el codi per la crida, hem
de cercar tots els llocs on el codi està duplicat. De vegades no és fàcil, ja
que poden haver-hi diferents noms de variables o el codi pot aparèixer barrejat
amb altres funcionalitats. Pot arribar a ser un repte.</p>
<p><img alt="exerciseicon__T" src="_images/exerciseicon__T.png" /> <a class="reference internal" href="exercici_52_15_extraccio.html"><span class="doc"> Exercici 52_15. Quantitat per lloguer</span></a></p>
<p><img alt="exerciseicon___" src="_images/exerciseicon___.png" /> <a class="reference internal" href="exercici_52_16_documentacio.html"><span class="doc"> Exercici 52_16. Documentem l'extracció</span></a></p>
</section>
</section>


           </div>
          </div>
    <div class="googleanalytics">
    <div id="cookiesbox">
        Aquest lloc web utilitza galetes (<i>cookies</i>) per a analitzar el seu ús
        amb les eines que ofereix <a href="https://www.google.com/analytics">Google Analytics</a>.
        En continuar navegant-hi, estàs acceptant-ho.
        <br/>
        <a class="btn btn-neutral" onclick="setUserAcceptsCookies();">
            Tancar
            <span class="fa fa-window-close"></span>
        </a>
    </div>
    <script>setCookiesboxVisibility();</script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41103782-2', 'auto');
      ga('send', 'pageview');
    </script>
</div>

          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="refactoring_exemple_objectiu.html" class="btn btn-neutral float-left" title="Objectiu de refacció" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="refactoring_method_movement.html" class="btn btn-neutral float-right" title="Moviment de mètodes" accesskey="n" rel="next">Següent <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023-2024 Moisès Gómez Girón.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-41103782-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-41103782-2', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>